<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="kavience 的博客, 专注于前端开发, web开发, 编程技术-Web前端优化总结">
    <meta name="keyword"  content="kavience,javascript,前端开发,php,react,kavience博客,Web前端优化总结">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Web前端优化总结 - kavience | Blog
        
    </title>

    <link rel="canonical" href="http://www.kavience.com/article/WEB前端/web前端优化总结/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">


    
<link rel="stylesheet" href="/css/donate.css">

    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/feed.xml" title="kavience" type="application/atom+xml">
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#JavaScript" title="JavaScript">JavaScript</a>
                            
                              <a class="tag" href="/tags/#优化" title="优化">优化</a>
                            
                        </div>
                        <h1>Web前端优化总结</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by kavience on
                            2020-08-04
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">kavience</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">首页</a>
          </li>

              
          <li>
            <a
              href="/archive/"
              >归档</a
            >
          </li>
            
          <li>
            <a
              href="/tags/"
              >标签</a
            >
          </li>
            
          <li>
            <a
              href="/about/"
              >关于</a
            >
          </li>
           
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<script>
  // Drop Bootstarp low-performance Navbar
  // Use customize navbar with high-quality material design animation
  // in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  $toggle.addEventListener("click", handleMagic);
  function handleMagic(e) {
    if ($navbar.className.indexOf("in") > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function () {
        // prevent frequently toggle
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    } else {
      // OPEN
      $collapse.style.height = "auto";
      $navbar.className += " in";
    }
  }
</script>


    <!-- Main Content -->
    
<!-- Post Content -->
<article>
    <div class="container" style="overflow: hidden">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="what"><a class="header-anchor" href="#what"></a>What</h2>
<p>针对 web 前端优化方案的总结, 主要技术栈为 React。</p>
<h2 id="why"><a class="header-anchor" href="#why"></a>Why</h2>
<p>与以往 PHP, JSP 等服务端渲染不同, 现如今大多数 web 端采用 React, Vue, Angular 等客户端渲染方案。单页应用带来的好处是显而易见的, 前端开发人员可以专注于前端页面的交互, 后端人员专注于数据的处理, 分工明确。另一方面得益于 nodejs 的生态, 例如 npm 包管理, webpack, gulp 打包等, 前端开发人员可以避免重复造轮子, 开发也变得越来越迅速。然而单页应用也带来另一个问题, 随着引入的库越来越多, 项目也越来越臃肿, 页面加载速度奇慢无比, 本文主要讨论针对 webpack 手动搭建的 React 项目为例做优化。</p>
<h2 id="how"><a class="header-anchor" href="#how"></a>How</h2>
<p>首先简单罗列一下 web 开发中可以优化的点有哪些:</p>
<ul>
<li>引入 CDN 资源, 图片、视频等大文件资源也可以通过 oss 等其它方式引入;</li>
<li>图片、icon 等使用 SVG;</li>
<li>样式优化( style-loader, mini css );</li>
<li>代码优化(减少 re-render 次数);</li>
<li>文件开启 GZip 压缩( Nodejs, Nginx );</li>
<li>代码拆分( webpack DllPlugin, webpack splitChunks, React.lazy );</li>
<li>客户端缓存( Cache-Control )。</li>
</ul>
<p>下面依次讲解。</p>
<h3 id="cdn-资源引入"><a class="header-anchor" href="#cdn-资源引入"></a>CDN 资源引入</h3>
<p>这是最简单粗暴的, 打包后的资源文件, 如果不做任何优化, 大部分项目中压缩后的 vender.xxx.js 文件, 大概会有 5-8 M,在国内采用 CDN 加载, 时间大概 1 - 2 s 左右, 在次基础上, 还可以进行 GZip 压缩, 以 <a href="https://help.aliyun.com/knowledge_detail/39645.html" target="_blank" rel="noopener">阿里 oss</a> 为例子, 采用 GZip 压缩后的资源, 大小会差不多减少三分之二, 访问时间会在 1 秒左右, 如果对项目访问速度要求不高, 这完全足够了。</p>
<p>另外, 例如图片、视频、音频等大文件, 肯定是要采用 CDN 的, 可能还要引入流的概念, 这里就不累述了(关键我也不熟悉)。</p>
<h3 id="图片-icon-等使用-svg"><a class="header-anchor" href="#图片-icon-等使用-svg"></a>图片、icon 等使用 SVG</h3>
<p>SVG 的优势(来源谷歌):</p>
<ul>
<li>SVG 图像可通过文本编辑器来创建和修改；</li>
<li>SVG 图像可被搜索、索引、脚本化或压缩；</li>
<li>SVG 是可伸缩的；</li>
<li>SVG 图像可在任何的分辨率下被高质量地打印；</li>
<li>SVG 可在图像质量不下降的情况下被放大；</li>
</ul>
<p>另外还有些个人认为的优势, SVG 可以做动画, 可以嵌入 HTML 文件, 减少 HTTP 请求。</p>
<h3 id="样式优化-style-loader-mini-css"><a class="header-anchor" href="#样式优化-style-loader-mini-css"></a>样式优化( style-loader, mini css )</h3>
<p>针对样式, 大部分项目中会使用 less,sass 或者 stylus, 通过 <code>less-loader</code>, <code>sass-loader</code> 等各种 loader, 最后基本有两种方案, 一是通过 <code>css-loader</code> 和 <code>style-loader</code> 把生成后的样式嵌入 HTML, 作为 style 标签引入, 另一种是通过 <code>css-loader</code> 和 <code>miniCssExtractPlugin</code> 生成压缩后的 css 引入。两种方式我觉得都没什么问题, 差不多, 但我更喜欢后者。嵌入到 HTML 可以减少 HTTP 请求, 但是压缩后的样式再经过 GZip 压缩其实也就几十毫秒左右。</p>
<h3 id="代码优化-减少-re-render-次数"><a class="header-anchor" href="#代码优化-减少-re-render-次数"></a>代码优化(减少 re-render 次数)</h3>
<p>代码优化根据项目采用的框架不同, 优化方案也不同, 但万变不离其宗, 主要是减少重渲染次数。</p>
<p>以 React 为例, 减少 <code>componentWillReceiveProps</code> , 使用 hooks 等, 注意 state 的值, 注意什么时候该用 props, 什么时候该用 state。props 和 state 的改变都会引起 re-render , 我的总结就是: 「 在组件中, 这个值会经常改变, 再<code>考虑</code>把这个值设为 state 。」 其实也不一定准确, 还是得看具体情况, 比如, <code>editable</code>, <code>visible</code> 等这类表示某些状态的, 大多数时候都作为 state, 但也有例外, 比如 <code>loading</code>, 业务不一样, 可能在会引入 <code>redux</code> 全局状态, 在发生 HTTP 请求的时候, 设置 <code>loading</code> 为 true, 组件可以从全局去拿这个状态值。</p>
<h3 id="文件开启-gzip-压缩-nodejs-nginx-等"><a class="header-anchor" href="#文件开启-gzip-压缩-nodejs-nginx-等"></a>文件开启 GZip 压缩( Nodejs, Nginx 等 )</h3>
<p>GZip 在上述方案中多次提到, 如果你不想使用 CDN, 就想部署在自己的服务器中, 开启 GZip 根据不同的 web 容器, 设置的方式也不一样, 但总体思路差不多。</p>
<p>先说 nodejs , 基于 nodejs 的 <a href="https://nodejs.org/docs/latest-v12.x/api/zlib.html#zlib_class_zlib_gzip" target="_blank" rel="noopener">GZip</a> , 根据不同的 nodejs 框架有不同的使用方案, 我使用的是 koa, 引入的是 <code>koa-compress</code>, 使用方式如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> compress = <span class="built_in">require</span>(<span class="string">"koa-compress"</span>);</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> Koa();</span><br><span class="line">server.use(</span><br><span class="line">  compress(&#123;</span><br><span class="line">    threshold: <span class="number">1024</span>,</span><br><span class="line">    gzip: &#123;</span><br><span class="line">      flush: <span class="built_in">require</span>(<span class="string">"zlib"</span>).Z_SYNC_FLUSH,</span><br><span class="line">    &#125;,</span><br><span class="line">    deflate: &#123;</span><br><span class="line">      flush: <span class="built_in">require</span>(<span class="string">"zlib"</span>).Z_SYNC_FLUSH,</span><br><span class="line">    &#125;,</span><br><span class="line">    br: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Nginx, Apache 等 web 容器, 编辑 conf 文件即可, 以 Nginx 为例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment"># 开启gzip</span></span><br><span class="line">gzip on;</span><br><span class="line"><span class="comment"># 启用gzip压缩的最小文件, 小于设置值的文件将不会压缩</span></span><br><span class="line">gzip_min_length 1k;</span><br><span class="line"><span class="comment"># gzip 压缩级别, 1-9, 数字越大压缩的越好, 也越占用CPU时间, 后面会有详细说明</span></span><br><span class="line">gzip_comp_level 1;</span><br><span class="line"><span class="comment"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span></span><br><span class="line">gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;</span><br><span class="line"><span class="comment"># 是否在http header中添加Vary: Accept-Encoding, 建议开启</span></span><br><span class="line">gzip_vary on;</span><br><span class="line"><span class="comment"># 禁用IE 6 gzip</span></span><br><span class="line">gzip_disable <span class="string">"MSIE [1-6]\."</span>;</span><br><span class="line"><span class="comment"># 设置压缩所需要的缓冲区大小</span></span><br><span class="line">gzip_buffers 32 4k;</span><br><span class="line"><span class="comment"># 设置gzip压缩针对的HTTP协议版本, 没做负载的可以不用</span></span><br><span class="line"><span class="comment"># gzip_http_version 1.0;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Apache 类似。</p>
<h3 id="代码拆分-webpack-dllplugin-webpack-splitchunks-react-lazy"><a class="header-anchor" href="#代码拆分-webpack-dllplugin-webpack-splitchunks-react-lazy"></a>代码拆分( webpack DllPlugin, webpack splitChunks, React.lazy )</h3>
<h4 id="webpack-dllplugin"><a class="header-anchor" href="#webpack-dllplugin"></a>webpack DllPlugin</h4>
<p>使用 <code>webpack.DllPlugin</code> , 可以把常用的且基本不变的库, 单独拆分出去, 且仅需 build 一次, 可以提升打包的速度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dll.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">"copy-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    react: [<span class="string">"react"</span>, <span class="string">"react-dom"</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">"production"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"[name].dll.[hash:6].js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>, <span class="string">"dll"</span>),</span><br><span class="line">    library: <span class="string">"[name]_dll"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">"[name]_dll"</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">"dist"</span>, <span class="string">"dll"</span>, <span class="string">"manifest.json"</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在项目中使用:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      manifest: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'dll'</span>, <span class="string">'manifest.json'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line"><span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">    cleanOnceBeforeBuildPatterns: [<span class="string">'**/*'</span>, <span class="string">'!dll'</span>, <span class="string">'!dll/**'</span>, <span class="string">'!pdfjs'</span>, <span class="string">'!pdfjs/**'</span>],</span><br><span class="line">&#125;),</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第一次使用 webpack.dll.config.js 文件会对第三方库打包, 打包完成后就不会再打包它了, 然后每次运行 webpack.config.js 文件的时候, 都会打包项目中本身的文件代码, 当需要使用第三方依赖的时候, 会使用 DllReferencePlugin 插件去读取第三方依赖库。所以说它的打包速度会得到一个很大的提升。</p>
</blockquote>
<h4 id="webpack-splitchunks"><a class="header-anchor" href="#webpack-splitchunks"></a>webpack splitChunks</h4>
<p>通过 splitChunks, 会把这些库再单独拆分出去</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">"webpack-merge"</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">"./webpack.config.js"</span>);</span><br><span class="line"><span class="keyword">const</span> opimizeCss = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">"terser-webpack-plugin"</span>);</span><br><span class="line"><span class="comment">// 打包后文件大小分析</span></span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">"webpack-bundle-analyzer"</span>)</span><br><span class="line">  .BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  mode: <span class="string">"production"</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    runtimeChunk: &#123;</span><br><span class="line">      name: <span class="string">"manifest"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      maxInitialRequests: <span class="number">10</span>,</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          priority: <span class="number">1</span>,</span><br><span class="line">          name: <span class="string">"vendor"</span>,</span><br><span class="line">          test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          chunks: <span class="string">"initial"</span>,</span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        moment: &#123;</span><br><span class="line">          name: <span class="string">"moment"</span>,</span><br><span class="line">          priority: <span class="number">5</span>,</span><br><span class="line">          test: <span class="regexp">/[\/]node_modules[\/]moment[\/]/</span>,</span><br><span class="line">          chunks: <span class="string">"initial"</span>,</span><br><span class="line">          minSize: <span class="number">100</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        lodash: &#123;</span><br><span class="line">          name: <span class="string">"lodash"</span>,</span><br><span class="line">          priority: <span class="number">6</span>,</span><br><span class="line">          test: <span class="regexp">/[\/]node_modules[\/]lodash[\/]/</span>,</span><br><span class="line">          chunks: <span class="string">"initial"</span>,</span><br><span class="line">          minSize: <span class="number">100</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        antd: &#123;</span><br><span class="line">          name: <span class="string">"antd"</span>,</span><br><span class="line">          priority: <span class="number">7</span>,</span><br><span class="line">          test: <span class="regexp">/[\/]node_modules[\/]antd[\/]es[\/]/</span>,</span><br><span class="line">          chunks: <span class="string">"initial"</span>,</span><br><span class="line">          minSize: <span class="number">100</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> opimizeCss(),</span><br><span class="line">      <span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">        cache: <span class="literal">true</span>,</span><br><span class="line">        parallel: <span class="literal">true</span>,</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="keyword">new</span> BundleAnalyzerPlugin()],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="react-lazy"><a class="header-anchor" href="#react-lazy"></a>React.lazy</h4>
<p>理论上你可以对你的任何代码使用懒加载, 但我觉得仅对页面级别使用懒加载足以, 通过路由懒加载界面:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 路由列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routesMapping = &#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 首页</span></span><br><span class="line">  <span class="string">"/"</span>: React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"@/pages/welcome"</span>)),</span><br><span class="line">  <span class="string">"/welcome"</span>: React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"@/pages/welcome"</span>)),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">  map(routesMapping, (Component, key) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="keyword">get</span>(permissionsMapping, key) &amp;&amp; (</span><br><span class="line">        &lt;Route</span><br><span class="line">          exact</span><br><span class="line">          path=&#123;key&#125;</span><br><span class="line">        &gt;</span><br><span class="line">         &lt;Component</span><br><span class="line">            &#123;...this.props&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">...</span></span><br></pre></td></tr></table></figure>
<p>至此, 生产环境下打包后, 你的 js 文件将会分散为多个。</p>
<h3 id="客户端缓存-cache-control"><a class="header-anchor" href="#客户端缓存-cache-control"></a>客户端缓存( Cache-Control )</h3>
<p>经过以上的各种优化, 界面的访问速度已经很快了, 还有一个针对本地缓存的方案, 这个与开启 GZip 压缩类似, 以 nodejs 为例:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.request.path.indexOf(<span class="string">'/api'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">    ctx.set(<span class="string">'Cache-Control'</span>, <span class="string">'public'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ctx.set(<span class="string">'Cache-Control'</span>, <span class="string">'no-store, no-cache, must-revalidate'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.set(<span class="string">'max-age'</span>, <span class="number">7200</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>对除了 api 请求以外的请求进行缓存, 除了第一次访问需要网络请求资源以外, 下一次刷新将直接从本地缓存获取资源。</p>
<h2 id="总结"><a class="header-anchor" href="#总结"></a>总结</h2>
<p>优化 web 体验, 基本上是围绕 <code>减少资源大小( 压缩, 拆分 )</code>, <code>减少HTTP请求( svg , 样式优化 )</code>, <code>避免重绘和重排( 优化代码 )</code>, <code>提高 HTTP 访问速度( CDN )</code>, 如果大家有更好的优化方式, 欢迎一起讨论。</p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/未来的路/生命的脆弱/" data-toggle="tooltip" data-placement="top" title="生命的脆弱">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/未来的路/如果坚持一个行业五年/" data-toggle="tooltip" data-placement="top" title="如果坚持一个行业五年">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
                <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>

                <div class="aplayer"
                    data-id="2764926677"
                    data-server="netease"
                    data-type="playlist"
                    data-fixed="true" >
                </div>
                

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      /* span.toc-nav-number{
        display: none
      } */
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#what"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">What</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#why"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Why</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#how"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">How</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#cdn-资源引入"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">CDN 资源引入</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#图片-icon-等使用-svg"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">图片、icon 等使用 SVG</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#样式优化-style-loader-mini-css"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">样式优化( style-loader, mini css )</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#代码优化-减少-re-render-次数"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">代码优化(减少 re-render 次数)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#文件开启-gzip-压缩-nodejs-nginx-等"><span class="toc-nav-number">3.5.</span> <span class="toc-nav-text">文件开启 GZip 压缩( Nodejs, Nginx 等 )</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#代码拆分-webpack-dllplugin-webpack-splitchunks-react-lazy"><span class="toc-nav-number">3.6.</span> <span class="toc-nav-text">代码拆分( webpack DllPlugin, webpack splitChunks, React.lazy )</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#webpack-dllplugin"><span class="toc-nav-number">3.6.1.</span> <span class="toc-nav-text">webpack DllPlugin</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#webpack-splitchunks"><span class="toc-nav-number">3.6.2.</span> <span class="toc-nav-text">webpack splitChunks</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#react-lazy"><span class="toc-nav-number">3.6.3.</span> <span class="toc-nav-text">React.lazy</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#客户端缓存-cache-control"><span class="toc-nav-number">3.7.</span> <span class="toc-nav-text">客户端缓存( Cache-Control )</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">总结</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#JavaScript" title="JavaScript">JavaScript</a>
                        
                          <a class="tag" href="/tags/#优化" title="优化">优化</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>


<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "kavience";
    var disqus_identifier = "http://www.kavience.com/article/WEB%E5%89%8D%E7%AB%AF/web%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/";
    var disqus_url = "http://www.kavience.com/article/WEB%E5%89%8D%E7%AB%AF/web%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'な'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.2em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          
            <li>
              <a href="/sitemap.xml">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-sitemap fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            

          
          <li>
            <a href="/feed.xml">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
           
          <li>
            <a
              target="_blank"
              href="https://twitter.com/Mr_Kavience"
            >
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
           
          <li>
            <a
              target="_blank"
              href="https://www.zhihu.com/people/kavience-xiaofan"
            >
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-1x fa-inverse">知</i>
              </span>
            </a>
          </li>
             
          <li>
            <a
              target="_blank"
              href="https://github.com/kavience"
            >
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
           
        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          <a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">赣ICP备17009879号</a> kavience 2021
          <span class="post-count">
            & 28.5k words altogether</span
          >
          <br />
          Theme by <a href="http://huangxuan.me" target="_blank" rel="noopener">Hux</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          re-Ported by <a href="http://www.kavience.com">kavience</a> |
          <iframe
            style="margin-left: 2px; margin-bottom: -5px;"
            frameborder="0"
            scrolling="0"
            width="91px"
            height="20px"
            src="https://ghbtns.com/github-btn.html?user=kavience&repo=blog&type=star&count=true"
          >
          </iframe>
        </p>
      </div>
    </div>
  </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
  function async(u, c) {
    var d = document,
      t = "script",
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener(
        "load",
        function (e) {
          c(null, e);
        },
        false
      );
    }
    s.parentNode.insertBefore(o, s);
  }
</script>

<!-- jquery.tagcloud.js -->
<script>
  // only load tagcloud.js in tag.html
  if ($("#tag_cloud").length !== 0) {
    async(
      "http://www.kavience.com/js/jquery.tagcloud.js",
      function () {
        $.fn.tagcloud.defaults = {
          //size: {start: 1, end: 1, unit: 'em'},
          color: { start: "#bbbbee", end: "#0085a1" },
        };
        $("#tag_cloud a").tagcloud();
      }
    );
  }
</script>

<!--fastClick.js -->
<script>
  async(
    "https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",
    function () {
      var $nav = document.querySelector("nav");
      if ($nav) FastClick.attach($nav);
    }
  );
</script>

<!-- Google Analytics -->


<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-171834825-2"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "UA-171834825-2");
</script>



<!-- Baidu Tongji -->




	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://www.kavience.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
